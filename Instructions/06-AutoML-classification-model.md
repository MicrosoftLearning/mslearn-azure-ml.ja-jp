---
lab:
  title: 自動機械学習の最適な分類モデルを見つける
---

# 自動機械学習の最適な分類モデルを見つける

モデル トレーニングの適切なアルゴリズムと前処理変換を決定するには、多くの推測と実験が必要です。

この演習では、Automated Machine Learning を使用して、複数のトレーニングを並行して実行することで、モデルに最適なアルゴリズムと前処理手順を決定します。

## 開始する前に

管理レベルのアクセス権を持つ [Azure サブスクリプション](https://azure.microsoft.com/free?azure-portal=true)が必要です。

## Azure Machine Learning ワークスペースをプロビジョニングする

Azure Machine Learning ''ワークスペース'' では、モデルのトレーニングと管理に必要なすべてのリソースと資産を管理するための中心的な場所が提供されます。** Azure Machine Learning ワークスペースは、スタジオ、Python SDK、Azure CLI を使用して操作できます。

Azure CLI を使用してワークスペースと必要なコンピューティングをプロビジョニングし、Python SDK を使用して自動機械学習で分類モデルをトレーニングします。

### ワークスペースとコンピューティング リソースを作成する

Azure Machine Learning ワークスペース、コンピューティング インスタンス、コンピューティング クラスターを作成するには、Azure CLI を使用します。 実行するために必要なすべてのコマンドがシェル スクリプトにグループ化されます。

1. ブラウザーで、Azure portal (`https://portal.azure.com/`) を開き、Microsoft アカウントでサインインします。
1. ページ上部の検索ボックスの右側にある \[>_] (*Cloud Shell*) ボタンを選びます。 これにより、ポータルの下部に Cloud Shell ペインが開きます。
1. メッセージが表示されたら、 **[Bash]** を選択します。 Cloud Shell を初めて開いたときに、使用するシェルの種類 (*Bash* または *PowerShell*) を選択するように求められます。
1. 正しいサブスクリプションが指定されていることと、**[ストレージ アカウントは不要]** が選択されていることを確認します。 **適用**を選択します。
1. ターミナルで、次のコマンドを入力して、このリポジトリをクローンします。

    ```azurecli
    rm -r azure-ml-labs -f
    git clone https://github.com/MicrosoftLearning/mslearn-azure-ml.git azure-ml-labs
    ```

    > コピーしたコードを Cloud Shell に貼り付けるには、`SHIFT + INSERT` を使用します。

1. リポジトリがクローンされたら、次のコマンドを入力してこのラボ用のフォルダーに移動し、そこに含まれている **setup.sh** スクリプトを実行します。

    ```azurecli
    cd azure-ml-labs/Labs/06
    ./setup.sh
    ```

    > 拡張機能がインストールされていないことを示す (エラー) メッセージは無視します。

1. スクリプトが完了するまで待ちます。通常、約 5 分から 10 分かかります。

## ラボの資料をクローンする

ワークスペースと必要なコンピューティング リソースを作成したら、Azure Machine Learning スタジオを開き、ラボの資料をワークスペースに複製できます。

1. Azure portal で、**mlw-dp100-...** という名前の Azure Machine Learning ワークスペースに移動します。
1. Azure Machine Learning ワークスペースを選択し、その **[概要]** ページで **[スタジオの起動]** を選択します。 ブラウザーで別のタブが開き、Azure Machine Learning スタジオが開きます。
1. スタジオに表示されるすべてのポップアップを閉じます。
1. Azure Machine Learning スタジオ内で、 **[コンピューティング]** ページに移動し、前のセクションで作成したコンピューティング インスタンスとクラスターが存在することを確認します。 コンピューティング インスタンスが実行中である必要があります。クラスターはアイドル状態で、0 個のノードが実行中であるはずです。
1. **[コンピューティング インスタンス]** タブで、コンピューティング インスタンスを見つけて、 **[ターミナル]** アプリケーションを選択します。
1. ターミナルで、次のコマンドを実行して、コンピューティング インスタンスに Python SDK をインストールします。

    ```
    pip uninstall azure-ai-ml
    pip install azure-ai-ml
    ```

    > パッケージが見つからず、アンインストールできなかったことを示す (エラー) メッセージは無視します。

1. 次のコマンドを実行して、ノートブック、データ、その他のファイルを含む Git リポジトリをワークスペースにクローンします。

    ```
    git clone https://github.com/MicrosoftLearning/mslearn-azure-ml.git azure-ml-labs
    ```

1. コマンドが完了したら、 **[ファイル]** ペインで **[&#8635;]** をクリックしてビューを更新し、新しい **Users/<自分のユーザー名>/azure-ml-labs** フォルダーが作成されていることを確認します。**

## 自動機械学習を使用して分類モデルをトレーニングする

必要なすべてのリソースが揃ったので、ノートブックを実行して、自動機械学習ジョブを構成して送信できます。

1. **Labs/06/Classification with Automated Machine Learning.ipynb** ノートブックを開きます。

    > **[認証]** を選択し、認証を求める通知が表示されたら、必要な手順に従います。

1. ノートブックで **Python 3.8 - AzureML** カーネルが使用されていることを確認します。
1. ノートブック内のすべてのセルを実行します。

    Azure Machine Learning ワークスペースに新しいジョブが作成されます。 このジョブは、ジョブ構成で定義されている入力、使用されたデータ資産、モデルを評価するためのメトリックなどの出力を追跡します。

    自動機械学習ジョブに子ジョブが含まれていることに注目してください。子ジョブは、トレーニングされた個々のモデルと、実行に必要なその他のタスクを表しています。
1. **[ジョブ]** に移動し、**[auto-ml-class-dev]** 実験を選択します。
1. **[表示名]** 列でジョブを選択します。
1. 状態が **[完了]** に変わるのを待ちます。
1. 自動機械学習ジョブの状態が **[完了]** に変わったら、スタジオでジョブの詳細を確認します。
    - **[データ ガードレール]** タブには、トレーニング データに問題があったかどうかが表示されます。
    - **[モデル]** タブには、トレーニングされたすべてのモデルが表示されます。 最適なモデルの **[説明の表示]** を選択して、ターゲット値に最も影響を与える特徴を把握します。

## Azure リソースを削除する

Azure Machine Learning を調べ終わったら、不要な Azure のコストを避けるために作成したリソースを削除する必要があります。

1. [Azure Machine Learning スタジオ] タブを閉じて、Azure portal に戻ります。
1. Azure portal の **[ホーム]** ページで、**[リソース グループ]** を選択します。
1. **[rg-dp100-...]** リソース グループを選択します。
1. リソース グループの **[概要]** ページの上部で、**[リソース グループの削除]** を選択します。
1. リソース グループ名を入力して、削除することを確認し、**[削除]** を選択します。
