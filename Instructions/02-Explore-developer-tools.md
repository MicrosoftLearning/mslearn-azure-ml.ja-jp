---
lab:
  title: ワークスペース操作用の開発者ツールを探す
---

# ワークスペース操作用の開発者ツールを探す

さまざまなツールを使用して Azure Machine Learning ワークスペースを操作することができます。 実行する必要があるタスクと開発者ツールの好みに応じて、いつどのようなツールを使用するかを選択できます。 このラボは、ワークスペースの操作に一般的に使用される開発者ツールの概要として設計されています。 特定のツールの使用方法をより詳しく学習したい場合は、他のラボで探すことができます。

## 開始する前に

管理レベルのアクセス権を持つ [Azure サブスクリプション](https://azure.microsoft.com/free?azure-portal=true)が必要です。

Azure Machine Learning ワークスペースを操作するために一般的に使用される開発者ツールは次のとおりです。

- **Azure CLI** と Azure Machine Learning 拡張機能: このコマンド ライン アプローチは、インフラストラクチャの自動化に最適です。
- **Azure Machine Learning スタジオ**: ユーザー フレンドリな UI を使用して、ワークスペースとそのすべての機能を調べることができます。
- Azure Machine Learning 用 **Python SDK**: Jupyter ノートブックからジョブを送信し、モデルを管理するために使用します。データ サイエンティストに最適です。

これらの各ツールについて、そのツールで一般的に実行されるタスクについて説明します。

## Azure CLI を使用してインフラストラクチャをプロビジョニングする

データ サイエンティストが Azure Machine Learning を使用して機械学習モデルをトレーニングするには、必要なインフラストラクチャを設定する必要があります。 Azure CLI を Azure Machine Learning 拡張機能と共に使用して、Azure Machine Learning ワークスペースとコンピューティング インスタンスなどのリソースを作成できます。

まず、Azure Cloud Shell を開き、Azure Machine Learning 拡張機能をインストールし、Git リポジトリをクローンします。

1. ブラウザーで、Azure portal (`https://portal.azure.com/`) を開き、Microsoft アカウントでサインインします。
1. ページ上部の検索ボックスの右側にある \[>_] (*Cloud Shell*) ボタンを選びます。 これにより、ポータルの下部に Cloud Shell ペインが開きます。
1. メッセージが表示されたら、 **[Bash]** を選択します。 Cloud Shell を初めて開いたときに、使用するシェルの種類 (*Bash* または *PowerShell*) を選択するように求められます。
1. Cloud Shell のストレージを作成するように求められた場合は、正しいサブスクリプションが指定されていることを確認して、 **[ストレージの作成]** を選択します。 ストレージが作成されるまで待ちます。
1. 以前のバージョンとの競合を回避するには、このコマンドで、ML CLI 拡張機能 (バージョン 1 と 2 の両方) を削除します。
    
    ```azurecli
    az extension remove -n azure-cli-ml
    az extension remove -n ml
    ```

    > コピーしたコードを Cloud Shell に貼り付けるには、`SHIFT + INSERT` を使用します。

    > 拡張機能がインストールされていないことを示す (エラー) メッセージは無視します。

1. 次のコマンドを使用して、Azure Machine Learning (v2) 拡張機能をインストールします。
    
    ```azurecli
    az extension add -n ml -y
    ```

1. リソース グループを作成する。 近くの場所を選択します。
    
    ```azurecli
    az group create --name "rg-dp100-labs" --location "eastus"
    ```

1. ワークスペースを作成します。
    
    ```azurecli
    az ml workspace create --name "mlw-dp100-labs" -g "rg-dp100-labs"
    ```

1. ワークスペースとそれに関連付けられているリソースが作成されるまで待ちます。通常、これには約 5 分かかります。

## Azure CLI を使用してコンピューティング インスタンスを作成する

機械学習モデルをトレーニングするために必要なインフラストラクチャのもう 1 つの重要な部分が、**コンピューティング**です。 モデルはローカルでトレーニングできますが、クラウド コンピューティングを使用する方がスケーラブルでコスト効率が高くなります。

データ サイエンティストは、Azure Machine Learning ワークスペースで機械学習モデルを開発するときに、Jupyter ノートブックを実行できる仮想マシンを使用したいと考えています。 開発には、**コンピューティング インスタンス**が最適です。

Azure Machine Learning ワークスペースを作成した後、Azure CLI を使用してコンピューティング インスタンスを作成することもできます。

この演習では、次の設定でコンピューティング インスタンスを作成します。

- **コンピューティング名**: "コンピューティング インスタンスの名前。一意で、24 文字未満である必要があります。"**
- **仮想マシンのサイズ**: STANDARD_DS11_V2
- **コンピューティングの種類** (インスタンスまたはクラスター): ComputeInstance
- **Azure Machine Learning ワークスペースの名前**: mlw-dp100-labs
- **リソース グループ**: rg-dp100-labs

1. 次のコマンドを使用して、ワークスペースにコンピューティング インスタンスを作成します。 コンピューティング インスタンス名に "XXXX" が含まれている場合は、それを乱数に置き換えて一意の名前を作成します。

    ```azurecli
    az ml compute create --name "ciXXXX" --size STANDARD_DS11_V2 --type ComputeInstance -w mlw-dp100-labs -g rg-dp100-labs
    ```

    その名前のコンピューティング インスタンスが既に存在するというエラー メッセージが表示される場合は、名前を変更してコマンドを再試行してください。

## Azure CLI を使用してコンピューティング クラスターを作成する

コンピューティング インスタンスは開発に最適ですが、機械学習モデルをトレーニングする場合はコンピューティング クラスターの方が適しています。 コンピューティング クラスターを使用するためにジョブが送信された場合にのみ、0 を超えるノード数にサイズ変更され、ジョブが実行されます。 コンピューティング クラスターが不要になると、コストを最小限に抑えるために、自動的に 0 個のノードにサイズ変更されます。 

コンピューティング クラスターを作成するには、コンピューティング インスタンスの作成と同様に、Azure CLI を使用できます。

次の設定でコンピューティング クラスターを作成します。

- **コンピューティング名**: aml-cluster
- **仮想マシンのサイズ**: STANDARD_DS11_V2
- **コンピューティングの種類**: AmlCompute "(コンピューティング クラスターが作成されます)"**
- **最大インスタンス数**: "Maximum instances: 2"**
- **Azure Machine Learning ワークスペースの名前**: mlw-dp100-labs
- **リソース グループ**: rg-dp100-labs

1. 次のコマンドを使用して、ワークスペースにコンピューティング クラスターを作成します。
    
    ```azurecli
    az ml compute create --name "aml-cluster" --size STANDARD_DS11_V2 --max-instances 2 --type AmlCompute -w mlw-dp100-labs -g rg-dp100-labs
    ```

## Azure Machine Learning スタジオを使用してワークステーションを構成する

Azure CLI は自動化に最適ですが、実行したコマンドの出力を確認することもできます。 Azure Machine Learning スタジオを使用して、リソースと資産の作成が完了しているかを確認し、ジョブが正常に実行されたかを確認したり、ジョブが失敗した理由を確認したりできます。 

1. Azure portal で、**mlw-dp100-labs** という名前の Azure Machine Learning ワークスペースに移動します。
1. Azure Machine Learning ワークスペースを選択し、その **[概要]** ページで **[スタジオの起動]** を選択します。 ブラウザーで別のタブが開き、Azure Machine Learning スタジオが開きます。
1. スタジオに表示されるすべてのポップアップを閉じます。
1. Azure Machine Learning スタジオ内で、 **[コンピューティング]** ページに移動し、前のセクションで作成したコンピューティング インスタンスとクラスターが存在することを確認します。 コンピューティング インスタンスが実行中である必要があります。クラスターはアイドル状態で、0 個のノードが実行中であるはずです。

## Python SDK を使ってモデルをトレーニングする

必要なコンピューティングが作成されたことを確認したので、Python SDK を使用してトレーニング スクリプトを実行できます。 コンピューティング インスタンスに Python SDK をインストールして使用し、コンピューティング クラスターで機械学習モデルをトレーニングします。

1. **コンピューティング インスタンス**の**ターミナル** アプリケーションを選択して、ターミナルを起動します。
1. ターミナルで、次のコマンドを実行して、コンピューティング インスタンスに Python SDK をインストールします。

    ```
    pip uninstall azure-ai-ml
    pip install azure-ai-ml
    ```

    > パッケージがインストールされなかったことを示す (エラー) メッセージは無視します。

1. 次のコマンドを実行して、ノートブック、データ、その他のファイルを含む Git リポジトリをワークスペースにクローンします。

    ```
    git clone https://github.com/MicrosoftLearning/mslearn-azure-ml.git azure-ml-labs
    ```

1. コマンドが完了したら、 **[ファイル]** ペインで **[&#8635;]** を選択してビューを更新し、新しい **Users/<自分のユーザー名>/azure-ml-labs** フォルダーが作成されていることを確認します。**
1. **[Labs/02/Run training script.ipynb]** ノートブックを開きます。

    > **[認証]** を選択し、認証を求める通知が表示されたら、必要なステップに従います。

1. ノートブックで **Python 3.8 - AzureML** カーネルが使用されていることを確認します。 各カーネルには、独自のパッケージ セットがプレインストールされた独自のイメージがあります。
1. ノートブック内のすべてのセルを実行します。

Azure Machine Learning ワークスペースに新しいジョブが作成されます。 このジョブは、ジョブ構成で定義されている入力、使用されたコード、およびモデルを評価するためのメトリックなどの出力を追跡します。

## Azure Machine Learning スタジオでジョブ履歴を確認する

Azure Machine Learning ワークスペースにジョブを送信すると、Azure Machine Learning スタジオでその状態を確認できます。

1. ノートブックで出力として指定されたジョブ URL を選択するか、Azure Machine Learning スタジオの **[ジョブ]** ページに移動します。
1. **diabetes-training** という名前の新しい実験が表示されます。 最新のジョブ **[diabetes-pythonv2-train]** を選択します。
1. ジョブの **[プロパティ]** を確認します ジョブの次の**状態**に注目してください。
    - **[キューに登録済み]** : ジョブは、コンピューティングが使用可能になるのを待機しています。
    - **[準備中]** : コンピューティング クラスターがサイズ変更中か、環境がコンピューティング先にインストール中です。
    - **[実行中]** : トレーニング スクリプトが実行中です。
    - **[終了処理中]** : トレーニング スクリプトが実行され、ジョブがすべての最終情報で更新されています。
    - **[完了]** : ジョブは正常に完了し、終了しています。
    - **[失敗]** : ジョブは失敗し、終了しています。
1. **[出力 + ログ]** の **user_logs/std_log.txt** でスクリプトの出力を確認できます。 スクリプトの **print** ステートメントからの出力がここに表示されます。 スクリプトの問題によりエラーが発生した場合は、こちらにもエラー メッセージが表示されます。
1. **[コード]** の下に、ジョブ構成で指定したフォルダーが表示されます。 このフォルダーには、トレーニング スクリプトとデータセットが含まれています。

## Azure リソースを削除する

Azure Machine Learning を調べ終わったら、不要な Azure のコストを避けるために作成したリソースを削除する必要があります。

1. [Azure Machine Learning スタジオ] タブを閉じて、Azure portal に戻ります。
1. Azure portal の **[ホーム]** ページで、**[リソース グループ]** を選択します。
1. **rg-dp100-labs** リソース グループを選択します。
1. リソース グループの **[概要]** ページの上部で、**[リソース グループの削除]** を選択します。 
1. リソース グループ名を入力して、削除することを確認し、**[削除]** を選択します。
